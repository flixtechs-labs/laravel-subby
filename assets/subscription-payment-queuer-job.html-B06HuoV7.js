import{_ as s,r as n,c as t,a as e,e as o,d as i,b as p,o as c}from"./app-Vnr7Qnzh.js";const l={},r={id:"subscription-payment-queuer",tabindex:"-1"},h={class:"header-anchor",href:"#subscription-payment-queuer"},d=p(`<p>This is the job that needs to be called periodically to collect all the subscriptions (either renewals or schedules) that have to be paid and process the payments.</p><h2 id="what-it-does" tabindex="-1"><a class="header-anchor" href="#what-it-does"><span>What it does</span></a></h2><p>The queuer job uses the Payment Collector class. This class retrieves all pending subscription renewals and also all pending subscription plan change schedules, then the job dispatches new jobs for each type of payment method and action needed (renewal or schedule).</p><h3 id="what-happens-when-subscription-schedule-is-set-at-renewal-date" tabindex="-1"><a class="header-anchor" href="#what-happens-when-subscription-schedule-is-set-at-renewal-date"><span>What happens when subscription schedule is set at renewal date?</span></a></h3><p>Subscription schedule change has priority over renewal, so schedule change will be first processed. Plan change will set a new renewal time in the future, so this renewal will be pushed into the future and not processed at the same time schedule happens to avoid duplicates.</p><h3 id="how-does-the-package-avoid-double-charging" tabindex="-1"><a class="header-anchor" href="#how-does-the-package-avoid-double-charging"><span>How does the package avoid double charging?</span></a></h3><p>Both schedule and renewal jobs use Laravel&#39;s <a href="https://laravel.com/docs/8.x/queues#preventing-job-overlaps" target="_blank" rel="noopener noreferrer">Preventing Job Overlaps</a> without release, so only one job per subscription can be active.</p><h2 id="how-to-schedule" tabindex="-1"><a class="header-anchor" href="#how-to-schedule"><span>How to schedule</span></a></h2><p>Your task schedule is defined in the <code>app/Console/Kernel.php</code> file&#39;s schedule method.</p><div class="language-php line-numbers-mode" data-ext="php" data-title="php"><pre class="language-php"><code><span class="token keyword">use</span> <span class="token package"><span class="token punctuation">\\</span>Flixtechs<span class="token punctuation">\\</span>Subby<span class="token punctuation">\\</span>Jobs<span class="token punctuation">\\</span>SubscriptionPaymentQueuerJob</span><span class="token punctuation">;</span>

<span class="token variable">$schedule</span><span class="token operator">-&gt;</span><span class="token function">job</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">SubscriptionPaymentQueuerJob</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">everyFiveMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,10);function u(b,m){const a=n("Badge");return c(),t("div",null,[e("h1",r,[e("a",h,[e("span",null,[o("Subscription Payment Queuer "),i(a,{text:"new in v6.0",type:"tip"})])])]),d])}const g=s(l,[["render",u],["__file","subscription-payment-queuer-job.html.vue"]]),v=JSON.parse('{"path":"/v6.x/payments/jobs/subscription-payment-queuer-job.html","title":"Subscription Payment Queuer","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"What it does","slug":"what-it-does","link":"#what-it-does","children":[{"level":3,"title":"What happens when subscription schedule is set at renewal date?","slug":"what-happens-when-subscription-schedule-is-set-at-renewal-date","link":"#what-happens-when-subscription-schedule-is-set-at-renewal-date","children":[]},{"level":3,"title":"How does the package avoid double charging?","slug":"how-does-the-package-avoid-double-charging","link":"#how-does-the-package-avoid-double-charging","children":[]}]},{"level":2,"title":"How to schedule","slug":"how-to-schedule","link":"#how-to-schedule","children":[]}],"git":{"updatedTime":1716242914000,"contributors":[{"name":"Borja Puig","email":"bdpuig@gmail.com","commits":1},{"name":"Given Ncube","email":"givenyslim12@gmail.com","commits":1}]},"filePathRelative":"v6.x/payments/jobs/subscription-payment-queuer-job.md"}');export{g as comp,v as data};
